;
;  https://www.voip-info.org/asterisk-config-extensionsconf/
;

[Direction]

        ; appel pour le directeur = redirection vers secrétaire
        ; appels commencant par 100 = interne
        ; Dial(SIP/<id>, timeout)
        ; 100 - 189
exten => _1[0-8]X,1,Dial(SIP/${EXTEN},40)                           ; essais appel
exten => _1[0-8]X,2,Voicemail(${EXTEN}@Direction_voiceMail)         ; redirection vers voiceMail
        ; 199 = voiceMail
exten => 199,1,Answer()
exten => 199,2,VoiceMailMain(${CALLERID(num)}@Direction_voiceMail)
        ; Redirection appel vers autre département
        ; _1XX = Direction _2XX = Marketing _3XX = Administration _4XX = Atelier ==> patern matching
exten => _2XX,1,Goto(Marketing,${EXTEN},1)              ; 200 => Marketing
exten => _3XX,1,Goto(Administration,${EXTEN},1)         ; 300 => Administation
exten => _4XX,1,Goto(Atelier,${EXTEN},1)                ; 400 => atelier

[Marketing]

        ; mise en attente appel défaut
exten => 200,1,Answer()
exten => 200,n,Queue(Marketing_q)
exten => 200,n,Voicemail(${EXTEN}@Marketing_voiceMail)
exten => 200,n,Hangup()
        ; 200 - 289
exten => _2[0-8]X,1,Dial(SIP/${EXTEN},40)                           ; essais appel
exten => _2[0-8]X,2,Voicemail(${EXTEN}@Marketing_voiceMail)         ; redirection vers voicemail
        ; 299 = voiceMail
exten => 299,1,Answer()
exten => 299,2,VoiceMailMain(${CALLERID(num)}@Marketing_voiceMail)

exten => 291,1,Addqueuemember(Marketing_q,SIP/${CALLERID(num)})
exten => 291,2,Playback(agent-loginok)
exten => 291,3,Hangup()
exten => 292,1,Removequeuemember(Marketing_q,SIP/${CALLERID(num)})
exten => 292,2,Playback(agent-loggedoff)
exten => 292,3,Hangup()
        ; Redirection appel vers autre département
        ; _1XX = Direction _2XX = Marketing _3XX = Administration _4XX = Atelier ==> patern matching
        ; si appel direction -> redirection secrétaire = 105
exten => _1XX,1,Goto(Direction,105,1)
exten => _3XX,1,Goto(Marketing,${EXTEN},1)
exten => _4XX,1,Goto(Atelier,${EXTEN},1)

[Administration]

        ; mise en attente appel défaut
exten => 300,1,Answer()
exten => 300,n,Queue(Administration_q)
exten => 300,n,Voicemail(${EXTEN}@Administration_voiceMail)
exten => 300,n,Hangup()
        ; appels commencant par 300 = interne
exten => _3[0-8]X,1,Dial(SIP/${EXTEN},40)                           ; essais appel
exten => _3[0-8]X,2,Voicemail(${EXTEN}@Administration_voiceMail)    ; redirection vers voicemail

exten => 399,1,Answer()
exten => 399,2,VoiceMailMain(${CALLERID(num)}@Administration_voiceMail)

exten => 391,1,Addqueuemember(Administration_q,SIP/${CALLERID(num)})
exten => 391,2,Playback(agent-loginok)
exten => 391,3,Hangup()
exten => 392,1,Removequeuemember(Administration_q,SIP/${CALLERID(num)})
exten => 392,2,Playback(agent-loggedoff)
exten => 392,3,Hangup()
        ; _1XX = Direction _2XX = Marketing _3XX = Administration _4XX = Atelier ==> patern matching
        ; si appel direction -> redirection secrétaire = 105
exten => _1XX,1,Goto(Direction,105,1)
exten => _2XX,1,Goto(Administration,${EXTEN},1)
exten => _4XX,1,Goto(Atelier,${EXTEN},1)

[Atelier]
        ; appels commencant par 400 = interne
exten => _4[0-8]X,1,Dial(SIP/${EXTEN}, 40)                          ; essais appel
exten => _4[0-8]X,2,Voicemail(${EXTEN}@Atelier_voiceMail)           ; redirection vers voicemail

exten => 499,1,Answer()
exten => 499,2,VoiceMailMain(${CALLERID(num)}@Atelier_voiceMail)
        ; _1XX = Direction _2XX = Marketing _3XX = Administration _4XX = Atelier ==> patern matching
        ; si appel direction -> redirection secrétaire = 105
exten => _1XX,1,Goto(Direction,105,1)
exten => _2XX,1,Goto(Marketing,${EXTEN},1)
exten => _3XX,1,Goto(Administration,${EXTEN},1)

[Admin]
exten => _1XX,1,NoOp(Appel Pour la Direction)
exten => _1XX,2,Goto(Direction,105,1)
exten => _1XX,3,NoOp(Fin de l'appel)

exten => _2XX,1,NoOp(Appel Pour l'Marketing)
exten => _2XX,2,Goto(Marketing,200,1)
exten => _2XX,3,NoOp(Fin de l'appel)

exten => _3XX,1,NoOp(Appel Pour le Administration)
exten => _3XX,2,Goto(Administration,300},1)
exten => _3XX,3,NoOp(Fin de l'appel)

exten => _4XX,1,NoOp(Appel Pour l'Atelier)
exten => _4XX,2,Goto(Atelier,400},1)
exten => _4XX,3,NoOp(Fin de l'appel)

[Client]
exten => _XXX,1,NoOp(Appel d'un client)
exten => _XXX,2,Dial(SIP/105,40)
exten => _XXX,3,NoOp(Fin Appel d'un client)